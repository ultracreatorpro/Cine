<!DOCTYPE html>
<html lang="es" prefix="og: https://ogp.me/ns#">
<head>
    <!-- Metadatos SEO Fundamentales -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CryptoNews Pro | Noticias de Criptomonedas, Bitcoin, Ethereum & Blockchain</title>
    <meta name="description" content="Noticias actualizadas de criptomonedas, análisis de mercado Bitcoin y Ethereum, guías blockchain, precios en tiempo real y las últimas tendencias.">
    <meta name="keywords" content="criptomonedas, Bitcoin, Ethereum, blockchain, noticias crypto, trading, inversiones, finanzas digitales, BTC, ETH">

    <!-- Open Graph -->
    <meta property="og:title" content="CryptoNews Pro | Noticias de Criptomonedas & Blockchain">
    <meta property="og:description" content="La fuente más confiable de noticias y análisis sobre criptomonedas, Bitcoin, Ethereum y tecnología blockchain.">

    <!-- Fuentes y Librerías -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        /* --- (Tu CSS existente, ligeramente simplificado/compatibilizado) --- */
        :root {
            --primary: #1a73e8;
            --accent: #00c9a7;
            --dark: #121826;
            --light: #f8f9fa;
            --gray: #6c757d;
            --border: #e0e0e0;
            --card-bg: #ffffff;
            --shadow: 0 4px 12px rgba(0,0,0,0.08);
            --up-color: #00c9a7;
            --down-color: #ff4757;
        }
        *{box-sizing:border-box;margin:0;padding:0}
        body{font-family:'Inter',sans-serif;background:#f5f7fb;color:#222;line-height:1.6}
        .container{max-width:1400px;margin:0 auto;padding:0 20px}
        header{background:var(--card-bg);box-shadow:var(--shadow);position:relative;z-index:1000}
        .header-top{display:flex;justify-content:space-between;align-items:center;padding:15px 0;border-bottom:1px solid var(--border)}
        .logo{display:flex;align-items:center;gap:10px}
        .logo-img{width:40px;height:40px;border-radius:8px;background:linear-gradient(135deg,#1a73e8,#00c9a7);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700}
        .logo-text h1{font-size:20px}
        .header-actions{display:flex;gap:12px;align-items:center}
        .theme-toggle{background:none;border:none;cursor:pointer;font-size:18px;color:var(--gray)}
        .whatsapp-button{background:#25D366;color:#fff;border:none;padding:8px 16px;border-radius:6px;cursor:pointer;display:flex;align-items:center;gap:8px}
        .header-nav{padding:12px 0}
        .nav-links{display:flex;gap:18px;list-style:none}
        .nav-links a{color:var(--dark);text-decoration:none;font-weight:500}
        .ad-banner{background:#f8f9fa;border-radius:8px;border:1px dashed #ccc;height:100px;display:flex;align-items:center;justify-content:center;margin:20px 0}
        .market-overview{background:var(--card-bg);border-radius:12px;padding:25px;margin:30px 0;box-shadow:var(--shadow)}
        .market-overview h2{display:flex;justify-content:space-between;align-items:center;font-size:20px;margin-bottom:10px}
        .market-stats{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px}
        .stat-card{background:#f8f9fa;border-radius:8px;padding:18px;border-left:4px solid var(--primary)}
        .stat-card h3{font-size:13px;color:var(--gray);margin-bottom:8px}
        .stat-value{font-weight:700;font-size:20px;color:var(--dark)}
        .stat-change{font-size:13px;margin-top:6px}
        .chart-container{margin-top:20px;height:400px}
        .main-content{display:grid;grid-template-columns:1fr 350px;gap:30px;margin:30px 0}
        .news-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:25px}
        .news-card{background:var(--card-bg);border-radius:12px;overflow:hidden;box-shadow:var(--shadow)}
        .news-card img{width:100%;height:200px;object-fit:cover}
        .news-card-content{padding:16px}
        .sidebar{display:flex;flex-direction:column;gap:20px}
        .sidebar-widget{background:var(--card-bg);border-radius:12px;padding:18px;box-shadow:var(--shadow)}
        .top-cryptos{list-style:none;padding:0;margin:0}
        .crypto-item{display:flex;justify-content:space-between;align-items:center;padding:10px 0;border-bottom:1px solid var(--border);cursor:pointer}
        .crypto-info{display:flex;gap:10px;align-items:center}
        .crypto-icon{width:36px;height:36px;border-radius:50%;display:flex;align-items:center;justify-content:center;background:#f0f0f0;font-weight:700}
        .crypto-name{font-weight:600}
        .crypto-symbol{color:var(--gray);font-size:13px}
        .crypto-price{text-align:right;font-weight:700}
        .crypto-change{font-weight:600;font-size:13px}
        footer{background:var(--dark);color:#fff;padding:60px 0;margin-top:40px}
        .footer-content{display:grid;grid-template-columns:repeat(4,1fr);gap:30px;margin-bottom:20px}
        .copyright{text-align:center;color:#b0b7c3;font-size:13px;padding-top:10px;border-top:1px solid rgba(255,255,255,0.06)}
        @media(max-width:1200px){.main-content{grid-template-columns:1fr}}
        @media(max-width:768px){.nav-links{flex-wrap:wrap;justify-content:center} .news-grid{grid-template-columns:1fr}}
    </style>
</head>
<body itemscope itemtype="https://schema.org/WebPage">

<header>
    <div class="container">
        <div class="header-top">
            <div class="logo">
                <div class="logo-img">CNP</div>
                <div class="logo-text">
                    <h1>Crypto<span style="color:var(--primary)">News</span> Pro</h1>
                    <div style="font-size:12px;color:var(--gray)">Noticias y Análisis de Criptomonedas</div>
                </div>
            </div>
            <div class="header-actions">
                <button class="theme-toggle" id="themeToggle" aria-label="Cambiar tema"><i class="fas fa-moon"></i></button>
                <button class="whatsapp-button" id="whatsappButton"><i class="fab fa-whatsapp"></i> Únete al Canal</button>
            </div>
        </div>
        <nav class="header-nav" aria-label="Navegación principal">
            <ul class="nav-links">
                <li><a href="#inicio" class="active">Inicio</a></li>
                <li><a href="#noticias">Noticias</a></li>
                <li><a href="#mercado">Mercado</a></li>
                <li><a href="#analisis">Análisis</a></li>
                <li><a href="#blockchain">Blockchain</a></li>
                <li><a href="#nfts">NFTs</a></li>
                <li><a href="#defi">DeFi</a></li>
                <li><a href="#guias">Guías</a></li>
            </ul>
        </nav>
    </div>
</header>

<!-- Video -->
<div class="container">
    <div class="youtube-video">
        <div class="video-title" style="background:var(--dark);color:#fff;padding:12px;border-radius:8px 8px 0 0;">
            <span><i class="fas fa-play-circle"></i> Video Destacado del Canal</span>
            <small style="color:#cfd6df">Suscríbete para más contenido</small>
        </div>
        <div class="video-container" style="position:relative;padding-bottom:56.25%;height:0;overflow:hidden;border-radius:0 0 12px 12px;">
            <!-- REEMPLAZA EL ID DEL VIDEO -->
            <iframe src="https://www.youtube.com/embed/YOUR_VIDEO_ID?rel=0&modestbranding=1" 
                    title="Análisis de mercado de criptomonedas - CryptoNews Pro" 
                    frameborder="0" 
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                    allowfullscreen
                    style="position:absolute;top:0;left:0;width:100%;height:100%;border:0"></iframe>
        </div>
    </div>
</div>

<!-- Ad banner -->
<div class="container"><div class="ad-banner horizontal">Espacio Publicitario (728x90)</div></div>

<!-- Market Overview -->
<section class="market-overview">
    <div class="container">
        <h2>
            <span>Resumen del Mercado en Tiempo Real</span>
            <small id="lastUpdate" style="font-size:14px;color:var(--gray);font-weight:normal;">Actualizado hace <span id="updateTime">0</span> segundos</small>
        </h2>

        <div class="market-stats">
            <div class="stat-card" id="marketCapCard">
                <h3>Capitalización Total</h3>
                <div class="stat-value loading" id="marketCapValue">-</div>
                <div class="stat-change" id="marketCapChange">-</div>
            </div>
            <div class="stat-card" id="volumeCard">
                <h3>Volumen (24h)</h3>
                <div class="stat-value loading" id="volumeValue">-</div>
                <div class="stat-change" id="volumeChange">-</div>
            </div>
            <div class="stat-card" id="btcDominanceCard">
                <h3>Dominancia BTC</h3>
                <div class="stat-value loading" id="btcDominanceValue">-</div>
                <div class="stat-change" id="btcDominanceChange">-</div>
            </div>
            <div class="stat-card" id="fearGreedCard">
                <h3>Índice Miedo y Codicia</h3>
                <div class="stat-value loading" id="fearGreedValue">-</div>
                <div class="stat-change" id="fearGreedChange">-</div>
            </div>
        </div>

        <div class="chart-container">
            <canvas id="marketChart" aria-label="Gráfico de precios de Bitcoin y Ethereum"></canvas>
        </div>
    </div>
</section>

<!-- Main -->
<div class="container">
    <div class="main-content">
        <div class="content-left">
            <!-- Featured article + news grid (omitido por brevedad, puedes mantener tu HTML existente) -->
            <div class="ad-banner small" style="height:250px;margin:20px 0">Espacio Publicitario (300x250)</div>

            <div class="news-grid">
                <!-- Mantén tus news-cards existentes -->
                <article class="news-card">
                    <img src="https://images.unsplash.com/photo-1516245834210-8a4f85e7d381?auto=format&fit=crop&w=600&q=80" alt="Bitcoin ETF">
                    <div class="news-card-content">
                        <span style="display:inline-block;background:rgba(26,115,232,0.1;color:var(--primary);padding:4px 10px;border-radius:20px;font-weight:600;font-size:12px">MERCADO</span>
                        <h3 style="margin-top:10px">Aprobación de ETF de Bitcoin podría llegar en los próximos meses según analistas</h3>
                        <p style="color:var(--gray)">Los reguladores estadounidenses están reevaluando las solicitudes de ETF de Bitcoin.</p>
                    </div>
                </article>
                <!-- ... otras noticias ... -->
            </div>
        </div>

        <aside class="sidebar">
            <div class="ad-banner vertical" style="height:600px">Espacio Publicitario (300x600)</div>

            <div class="sidebar-widget">
                <h3><i class="fas fa-chart-line"></i> Top Criptomonedas</h3>
                <ul class="top-cryptos" id="cryptoList">
                    <!-- Se llenará con JS -->
                    <li style="color:var(--gray);text-align:center;padding:12px 0">Cargando precios...</li>
                </ul>
            </div>

            <div class="sidebar-widget newsletter">
                <h3>Únete a Nuestro Canal</h3>
                <p>Recibe noticias exclusivas y análisis en tiempo real a través de WhatsApp.</p>
                <button class="whatsapp-button" style="width:100%;justify-content:center"><i class="fab fa-whatsapp"></i> Unirse al Canal de WhatsApp</button>
            </div>

            <div class="sidebar-widget">
                <h3><i class="fas fa-fire"></i> Tendencias</h3>
                <div style="display:flex;flex-direction:column;gap:8px">
                    <div style="display:flex;justify-content:space-between"><div>#BitcoinHalving</div><div style="color:var(--gray)">2,345 posts</div></div>
                    <div style="display:flex;justify-content:space-between"><div>#Web3Gaming</div><div style="color:var(--gray)">1,892 posts</div></div>
                </div>
            </div>
        </aside>
    </div>
</div>

<!-- Footer -->
<footer>
    <div class="container">
        <div class="footer-content">
            <div>
                <div style="display:flex;align-items:center;gap:10px"><div class="logo-img">CNP</div><h4>Crypto<span style="color:var(--primary)">News</span> Pro</h4></div>
                <p style="margin-top:10px;color:#b0b7c3">Portal de noticias y análisis sobre criptomonedas.</p>
            </div>
            <div>
                <h4>Secciones</h4>
                <ul style="list-style:none;padding:0;color:#b0b7c3">
                    <li><a href="#noticias" style="color:inherit">Noticias</a></li>
                    <li><a href="#precios" style="color:inherit">Precios</a></li>
                </ul>
            </div>
            <div>
                <h4>Recursos</h4>
                <ul style="list-style:none;padding:0;color:#b0b7c3"><li><a href="#api" style="color:inherit">API para Desarrolladores</a></li></ul>
            </div>
            <div>
                <h4>Legal</h4>
                <ul style="list-style:none;padding:0;color:#b0b7c3"><li><a href="#privacidad" style="color:inherit">Política de Privacidad</a></li></ul>
            </div>
        </div>
        <div class="copyright">
            <p>&copy; 2023-2025 CryptoNews Pro. La información no constituye asesoramiento financiero.</p>
        </div>
    </div>
</footer>

<!-- ------------------ SCRIPTS ------------------ -->
<script>
/* ======================
   UTILIDADES DE FORMATO
   ====================== */
const formatter = new Intl.NumberFormat('en-US', {
    style: 'currency',
    currency: 'USD',
    minimumFractionDigits: 2,
    maximumFractionDigits: 8,
});
const formatCurrency = (value) => {
    if (value === null || value === undefined || Number.isNaN(Number(value))) return 'N/A';
    // Forzar prefijo $ y formato de miles
    return formatter.format(Number(value));
};
const formatPercentage = (value) => {
    if (value === null || value === undefined || Number.isNaN(Number(value))) return 'N/A';
    const sign = value >= 0 ? '+' : '';
    return `${sign}${Number(value).toFixed(2)}%`;
};
const formatMarketCap = (value) => {
    if (value === null || value === undefined || Number.isNaN(Number(value))) return 'N/A';
    const v = Number(value);
    if (v >= 1e12) return '$' + (v / 1e12).toFixed(2) + 'T';
    if (v >= 1e9) return '$' + (v / 1e9).toFixed(2) + 'B';
    if (v >= 1e6) return '$' + (v / 1e6).toFixed(2) + 'M';
    return formatCurrency(v);
};

/* ======================
   CHART.JS - INICIALIZAR
   ====================== */
let marketChart;
function initChart() {
    const ctx = document.getElementById('marketChart').getContext('2d');
    marketChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: [],
            datasets: [
                {
                    label: 'Bitcoin (USD)',
                    data: [],
                    borderWidth: 2,
                    tension: 0.25,
                    pointRadius: 0,
                    borderColor: '#f1c40f',
                },
                {
                    label: 'Ethereum (USD)',
                    data: [],
                    borderWidth: 2,
                    tension: 0.25,
                    pointRadius: 0,
                    borderColor: '#6f42c1',
                }
            ]
        },
        options: {
            responsive: true,
            animation: false,
            plugins: {
                legend: { display: true, position: 'top' },
                tooltip: { mode: 'index', intersect: false },
            },
            interaction: { mode: 'index', intersect: false },
            scales: {
                x: {
                    display: true,
                    title: { display: false }
                },
                y: {
                    beginAtZero: false,
                    ticks: {
                        callback: function(value) { return formatCurrency(value); }
                    }
                }
            }
        }
    });
}
initChart();

/* ======================
   FETCH DE DATOS (COINGECKO + GLOBAL + FNG)
   ====================== */
let secondsElapsed = 0;
let lastSuccessfulFetch = null;

async function fetchCryptoData() {
    const cryptoIds = 'bitcoin,ethereum,ripple,solana,cardano';
    const apiUrl = `https://api.coingecko.com/api/v3/simple/price?ids=${cryptoIds}&vs_currencies=usd&include_24hr_change=true&include_last_updated_at=true`;
    const globalApiUrl = 'https://api.coingecko.com/api/v3/global';
    const cryptoListElement = document.getElementById('cryptoList');

    try {
        // Par de fetch en paralelo
        const [priceResp, globalResp, fngResp] = await Promise.all([
            fetch(apiUrl),
            fetch(globalApiUrl),
            fetch('https://api.alternative.me/fng/') // Fear & Greed
        ]);

        if (!priceResp.ok) throw new Error('Error cargando precios');
        if (!globalResp.ok) throw new Error('Error cargando datos globales');
        if (!fngResp.ok) console.warn('No se pudo obtener Fear & Greed; continuará con valor N/A');

        const prices = await priceResp.json();
        const globalData = await globalResp.json();
        const fngData = fngResp.ok ? await fngResp.json() : null;

        // --- Resumen mercado ---
        const marketCapUSD = globalData?.data?.total_market_cap?.usd ?? null;
        const volume24hUSD = globalData?.data?.total_volume?.usd ?? null;
        const btcDominance = globalData?.data?.market_cap_percentage?.btc ?? null;
        const globalMarketChange = globalData?.data?.market_cap_change_percentage_24h_usd ?? null;

        // Actualizar DOM Market Stats
        document.getElementById('marketCapValue').textContent = formatMarketCap(marketCapUSD);
        const marketCapChangeEl = document.getElementById('marketCapChange');
        marketCapChangeEl.textContent = globalMarketChange !== null ? formatPercentage(globalMarketChange) + ' (24h)' : 'N/A';
        marketCapChangeEl.style.color = (globalMarketChange >= 0) ? 'var(--up-color)' : 'var(--down-color)';
        document.getElementById('volumeValue').textContent = formatMarketCap(volume24hUSD);
        document.getElementById('volumeChange').textContent = '-'; // si quieres calcular algún porcentaje, hazlo con datos históricos
        document.getElementById('btcDominanceValue').textContent = btcDominance !== null ? btcDominance.toFixed(2) + '%' : 'N/A';

        // Fear & Greed (alternative.me)
        if (fngData && Array.isArray(fngData.data) && fngData.data.length) {
            const fng = fngData.data[0];
            document.getElementById('fearGreedValue').textContent = `${fng.value}/100`;
            document.getElementById('fearGreedChange').textContent = fng.value_classification || '';
        } else {
            document.getElementById('fearGreedValue').textContent = 'N/A';
            document.getElementById('fearGreedChange').textContent = '';
        }

        // --- Lista Top Cryptos ---
        const cryptos = [
            { id: 'bitcoin', name: 'Bitcoin', symbol: 'BTC', icon: '₿' },
            { id: 'ethereum', name: 'Ethereum', symbol: 'ETH', icon: 'Ξ' },
            { id: 'ripple', name: 'Ripple', symbol: 'XRP', icon: 'X' },
            { id: 'solana', name: 'Solana', symbol: 'SOL', icon: 'S' },
            { id: 'cardano', name: 'Cardano', symbol: 'ADA', icon: 'A' },
        ];

        // Limpiar lista y poblar con datos
        cryptoListElement.innerHTML = '';
        cryptos.forEach(c => {
            const pdata = prices[c.id];
            const price = pdata?.usd ?? null;
            const change24h = pdata?.usd_24h_change ?? null;

            const li = document.createElement('li');
            li.className = 'crypto-item';

            li.innerHTML = `
                <div class="crypto-info">
                    <div class="crypto-icon">${c.icon}</div>
                    <div>
                        <div class="crypto-name">${c.name}</div>
                        <div class="crypto-symbol">${c.symbol}</div>
                    </div>
                </div>
                <div style="text-align:right">
                    <div class="crypto-price">${formatCurrency(price)}</div>
                    <div class="crypto-change" style="color:${(change24h>=0)?'var(--up-color)':'var(--down-color)'}">
                        <i class="fas ${(change24h>=0)?'fa-caret-up':'fa-caret-down'}"></i>
                        ${formatPercentage(change24h)}
                    </div>
                </div>
            `;
            cryptoListElement.appendChild(li);
        });

        // --- Actualizar gráfico (BTC y ETH) ---
        try {
            const now = new Date();
            const label = now.toLocaleTimeString();

            // Añadir label y valores
            marketChart.data.labels.push(label);
            marketChart.data.datasets[0].data.push(prices.bitcoin?.usd ?? null);
            marketChart.data.datasets[1].data.push(prices.ethereum?.usd ?? null);

            // Mantener último N puntos (p.ej. 40)
            const maxPoints = 40;
            if (marketChart.data.labels.length > maxPoints) {
                marketChart.data.labels.shift();
                marketChart.data.datasets.forEach(ds => ds.data.shift());
            }
            marketChart.update();
        } catch (chartError) {
            console.warn('Error actualizando gráfica:', chartError);
        }

        // Reiniciar contador de actualización
        secondsElapsed = 0;
        lastSuccessfulFetch = new Date();

    } catch (error) {
        console.error('Error al obtener los datos de la API:', error);
        // Mostrar error en la lista
        const cryptoListElement = document.getElementById('cryptoList');
        cryptoListElement.innerHTML = '<li style="color:var(--down-color);text-align:center;padding:10px 0">¡Error! No se pudieron cargar los precios.</li>';
        // Mostrar N/A en estadísticas
        document.getElementById('marketCapValue').textContent = 'N/A';
        document.getElementById('volumeValue').textContent = 'N/A';
        document.getElementById('btcDominanceValue').textContent = 'N/A';
        document.getElementById('fearGreedValue').textContent = 'N/A';
        secondsElapsed = 0;
    }
}

/* ======================
   INICIALIZAR Y TIMERS
   ====================== */
fetchCryptoData(); // primera carga
const POLL_INTERVAL_MS = 30000;
setInterval(fetchCryptoData, POLL_INTERVAL_MS);

// Contador de segundos desde la última actualización (0..POLL_INTERVAL_MS/1000)
setInterval(() => {
    const updateTimeElement = document.getElementById('updateTime');
    if (!updateTimeElement) return;
    secondsElapsed++;
    // Mostrar hasta máximo 999 (segundos)
    updateTimeElement.textContent = secondsElapsed;
    // Opcional: si hace mucho tiempo, cambiar estilo
    if (secondsElapsed > (POLL_INTERVAL_MS / 1000) + 10) {
        updateTimeElement.style.color = 'var(--gray)';
    } else {
        updateTimeElement.style.color = '';
    }
}, 1000);

/* ======================
   UI: Theme toggle (simple)
   ====================== */
document.getElementById('themeToggle').addEventListener('click', () => {
    const body = document.body;
    body.classList.toggle('dark-mode');
    // Puedes añadir estilos .dark-mode en CSS para mejorar.
});

/* ======================
   NOTAS:
   - Si quieres "streaming" real, integra WebSocket de un proveedor (p.ej. Binance WS para tickers),
     o un servicio de websockets de precios cripto. CoinGecko no ofrece websocket público.
   - Si esperas mucho tráfico, considera colocar un proxy backend que haga caching y evite límites.
   - Comprueba políticas CORS de los endpoints en producción.
   ====================== */
</script>

</body>
</html>
